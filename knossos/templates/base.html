{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Knossos{% endblock %}</title>
  <link href="{% static 'css/styles.css' %}" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/2.3.1/css/dataTables.tailwindcss.css" />
  <script src="https://cdn.datatables.net/2.3.1/js/dataTables.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">

</head>
<body class="min-h-screen bg-body-light flex flex-col">
  <header class="bg-blue-nav shadow relative z-40">
    <div class="container mx-auto px-4 py-4 flex flex-row items-center justify-between">
      <a href="{% url 'homepage' %}" class="text-2xl font-bold text-white">KNOSSOS travel</a>
      <button
        id="nav-toggle"
        type="button"
        class="lg:hidden text-white hover:text-gray-200 focus:outline-none"
        aria-label="Toggle navigation"
      >
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
      <nav
        id="main-nav"
        class="hidden lg:flex lg:items-center lg:justify-end lg:space-x-4 text-white"
      >
        <ul class="flex flex-col space-y-2 text-white lg:flex-row lg:space-y-0 lg:space-x-4">
          <li><a href="{% url 'excursion_list' %}" class="text-white hover:text-gray-200 {% if request.path == '/excursions/' %}font-semibold{% endif %}">Excursions</a></li>
          {% if user.is_authenticated %}
            {% if user.is_staff %}
              <li><a href="{% url 'admin_dashboard' user.profile.id %}" class="text-white hover:text-gray-200 {% if request.path == '/profile/admin/' %}font-semibold{% endif %}">Dashboard</a></li>
            {% else %}
              <li><a href="{% url 'profile' user.id %}" class="text-white hover:text-gray-200 {% if request.path == '/profile/' %}font-semibold{% endif %}">Profile</a></li>
            {% endif %}
            <li><a href="{% url 'logout' %}" class="text-white hover:text-gray-200 {% if request.path == '/logout/' %}font-semibold{% endif %}">Logout</a></li>
          {% else %}
            <li><a href="{% url 'login' %}" class="text-white hover:text-gray-200 {% if request.path == '/login/' %}font-semibold{% endif %}">Login</a></li>
            <li><a href="{% url 'signup' %}" class="text-white hover:text-gray-200 {% if request.path == '/signup/' %}font-semibold{% endif %}">Sign Up</a></li>
          {% endif %}
          {% if user.profile.role == None %}
            <li><a href="{% url 'booking_id_page' %}" class="py-2 text-sm px-1 rounded-md font-normal bg-white text-blue font-semibold {% if request.path == '/booking-id' %} {% endif %}">Check Booking</a></li>
          {% endif %}
        </ul>
      </nav>
    </div>

    <!-- Offcanvas overlay & panel for small/medium screens -->
    <div
      id="nav-overlay"
      class="fixed inset-0 bg-black/50 hidden lg:hidden z-30"
    >
      <div
        id="nav-panel"
        class="absolute right-0 top-0 h-full w-64 bg-blue-nav shadow-xl transform translate-x-full transition-transform duration-200 ease-out"
      >
        <div class="px-4 py-4 flex items-center justify-between border-b border-white/10">
          <button
            id="nav-close"
            type="button"
            class="text-white hover:text-gray-200 focus:outline-none"
            aria-label="Close navigation"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        <nav class="px-4 py-4">
          <ul class="space-y-3 text-white">
            <li><a href="{% url 'excursion_list' %}" class="block hover:text-gray-200 {% if request.path == '/excursions/' %}font-semibold{% endif %}">Excursions</a></li>
            {% if user.is_authenticated %}
              {% if user.is_staff %}
                <li><a href="{% url 'admin_dashboard' user.profile.id %}" class="block hover:text-gray-200 {% if request.path == '/profile/admin/' %}font-semibold{% endif %}">Dashboard</a></li>
              {% else %}
                <li><a href="{% url 'profile' user.id %}" class="block hover:text-gray-200 {% if request.path == '/profile/' %}font-semibold{% endif %}">Profile</a></li>
              {% endif %}
              <li><a href="{% url 'logout' %}" class="block hover:text-gray-200 {% if request.path == '/logout/' %}font-semibold{% endif %}">Logout</a></li>
            {% else %}
              <li><a href="{% url 'login' %}" class="block hover:text-gray-200 {% if request.path == '/login/' %}font-semibold{% endif %}">Login</a></li>
              <li><a href="{% url 'signup' %}" class="block hover:text-gray-200 {% if request.path == '/signup/' %}font-semibold{% endif %}">Sign Up</a></li>
            {% endif %}
            {% if user.profile.role == None %}
              <li><a href="{% url 'booking_id_page' %}" class="inline-block py-2 text-sm px-3 rounded-md font-normal bg-white text-blue font-semibold {% if request.path == '/booking-id' %} {% endif %}">Check Booking</a></li>
            {% endif %}
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main class="flex-grow">
    {% if messages %}
    <div class="container py-4 fixed top-4 right-4 z-50">
      {% for message in messages %}
        <div id="notification-{{ forloop.counter }}" class="mb-4 transform transition-all duration-300 ease-in-out {% if message.tags == 'success' %}bg-green-100 border-l-4 border-green-500 text-green-700{% elif message.tags == 'error' %}bg-red-100 border-l-4 border-red-500 text-red-700{% elif message.tags == 'warning' %}bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700{% else %}bg-blue-100 border-l-4 border-blue-500 text-blue-700{% endif %} p-4 rounded shadow-lg">
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              {% if message.tags == 'success' %}
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
              {% elif message.tags == 'error' %}
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                </svg>
              {% elif message.tags == 'warning' %}
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
              {% else %}
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
              {% endif %}
              <p class="font-medium">{{ message }}</p>
            </div>
            <button onclick="closeNotification('notification-{{ forloop.counter }}')" class="ml-4 text-gray-500 hover:text-gray-700 focus:outline-none">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>
        </div>
      {% endfor %}
    </div>
    {% endif %}
    {% block content %}{% endblock %}
  </main>

  <footer class="bg-white border-t border-gray-200">
    <div class="container mx-auto px-4 pt-4 pb-2 text-gray-600 text-xs md:text-sm">
      <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
        <div class="w-full md:w-1/6 flex justify-center md:justify-start">
          <img src="{% static 'images/EN_FundedbytheEU.png' %}" alt="Funded by the European Union" class="h-11 object-contain">
        </div>
        <div class="w-full md:w-5/6 text-left text-xs">
          Funded by the European Union. Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Innovation Council and SMEs Executive Agency (EISMEA). Neither the European Union nor the granting authority can be held responsible for them.
        </div>
      </div>
    </div>
    <!-- <hr class="border-gray-200"> -->
    <div class="container mx-auto px-4 pb-4 pt-2 text-center text-gray-600 text-sm">
      &copy; {% now "Y" %} Knossos. All rights reserved <a href="https://innovade.eu/" target="_blank" class="text-blue-500">Innovade LI LTD</a>
    </div>
  </footer>

  <script>
    function closeNotification(id) {
      const notification = document.getElementById(id);
      notification.style.opacity = '0';
      notification.style.transform = 'translateX(100%)';
      setTimeout(() => {
        notification.remove();
      }, 300);
    }

    // Auto-hide notifications after 3 seconds and set up nav toggle / offcanvas
    document.addEventListener('DOMContentLoaded', function() {
      const notifications = document.querySelectorAll('[id^="notification-"]');
      notifications.forEach(notification => {
        setTimeout(() => {
          closeNotification(notification.id);
        }, 3000);
      });

      const navToggle = document.getElementById('nav-toggle');
      const mainNav = document.getElementById('main-nav');
      const navOverlay = document.getElementById('nav-overlay');
      const navPanel = document.getElementById('nav-panel');
      const navClose = document.getElementById('nav-close');

      function openOffcanvas() {
        if (!navOverlay || !navPanel) return;
        // Show overlay first
        navOverlay.classList.remove('hidden');
        // Force reflow so transition runs when we change transform
        void navPanel.offsetWidth;
        navPanel.classList.remove('translate-x-full');
      }

      function closeOffcanvas() {
        if (!navOverlay || !navPanel) return;
        navPanel.classList.add('translate-x-full');
        setTimeout(() => {
          navOverlay.classList.add('hidden');
        }, 200);
      }

      if (navToggle) {
        navToggle.addEventListener('click', function() {
          // On small/medium screens use offcanvas, on large show inline nav
          if (window.matchMedia('(min-width: 1024px)').matches) {
            if (mainNav) {
              mainNav.classList.toggle('hidden');
            }
          } else {
            openOffcanvas();
          }
        });
      }

      if (navClose) {
        navClose.addEventListener('click', closeOffcanvas);
      }

      if (navOverlay) {
        navOverlay.addEventListener('click', function(e) {
          if (e.target === navOverlay) {
            closeOffcanvas();
          }
        });
      }
    });
  </script>
  
  {% block extra_js %}{% endblock %}
</body>
</html>
